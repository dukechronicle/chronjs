/*
 Galleria Picasa Plugin 2011-08-01
 http://galleria.aino.se

 Copyright 2011, Aino
 Licensed under the MIT license.
*/
Galleria.requires(1.25,"The Picasa Plugin requires Galleria version 1.2.5 or later.");
(function(f){var i=Galleria.utils.getScriptPath();Galleria.Picasa=function(){this.options={max:30,imageSize:"medium",thumbSize:"thumb",description:!1,complete:function(){}}};Galleria.Picasa.prototype={constructor:Galleria.Picasa,search:function(c,a){return this._call("search","all",{q:c},a)},user:function(c,a){return this._call("user","user/"+c,a)},useralbum:function(c,a,b){return this._call("useralbum","user/"+c+"/album/"+a,b)},setOptions:function(c){f.extend(this.options,c);return this},_call:function(c,
a,b,d){a="https://picasaweb.google.com/data/feed/api/"+a+"?";typeof b=="function"&&(d=b,b={});var e=this,b=f.extend({kind:"photo",access:"public","max-results":this.options.max,thumbsize:this._getSizes().join(","),alt:"json-in-script",callback:"?"},b);f.each(b,function(b,c){a+="&"+b+"="+c});var g=!1;Galleria.utils.wait({until:function(){return g},success:function(){e._parse.call(e,g.feed.entry,d)},error:function(){var a="";c=="user"?a="user not found.":c=="useralbum"&&(a="album or user not found.");
Galleria.raise("Picasa request failed"+(a?": "+a:"."))},timeout:5E3});f.getJSON(a,function(a){g=a});return e},_getSizes:function(){var c={small:"72c",thumb:"104u",medium:"640u",big:"1024u",original:"1600u"},a=this.options,b={},d,e=[32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600];f(["thumbSize","imageSize"]).each(function(){a[this]in c?b[this]=c[a[this]]:(d=Galleria.utils.parseValue(a[this]),d>1600?d=1600:f.each(e,function(a){if(d<this)return d=
e[a-1],!1}),b[this]=d)});return[b.thumbSize,b.imageSize,"1280u"]},_parse:function(c,a){var b=this,d=[],e;f.each(c,function(){e=this.media$group.media$thumbnail;d.push({thumb:e[0].url,image:e[1].url,big:e[2].url,title:this.title.$t,description:b.options.description?this.summary.$t:""})});a.call(this,d)}};var h=Galleria.prototype.load;Galleria.prototype.load=function(){if(arguments.length||typeof this._options.picasa!=="string")h.apply(this,Galleria.utils.array(arguments));else{var c=this,a=Galleria.utils.array(arguments),
b=this._options.picasa.split(":"),d,e=f.extend({},c._options.picasaOptions),g=typeof e.loader!=="undefined"?e.loader:f("<div>").css({width:48,height:48,opacity:0.7,background:"#000 url("+i+"loader.gif) no-repeat 50% 50%"});if(b.length){if(typeof Galleria.Picasa.prototype[b[0]]!=="function")return Galleria.raise(b[0]+" method not found in Picasa plugin"),h.apply(this,a);if(!b[1])return Galleria.raise("No picasa argument found"),h.apply(this,a);window.setTimeout(function(){c.$("target").append(g)},
100);d=new Galleria.Picasa;typeof c._options.picasaOptions==="object"&&d.setOptions(c._options.picasaOptions);a=[];if(b[0]=="useralbum"){if(a=b[1].split("/"),a.length!=2){Galleria.raise("Picasa useralbum not correctly formatted (should be [user]/[album])");return}}else a.push(b[1]);a.push(function(a){c._data=a;g.remove();c.trigger(Galleria.DATA);d.options.complete.call(d,a)});d[b[0]].apply(d,a)}else h.apply(this,a)}}})(jQuery);
